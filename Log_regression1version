> library(ggplot2)
> library(dplyr)
> library(Amelia)
> df.train <- read.csv('titanic_train.csv')
> df.train %>% head %>% str
'data.frame':	6 obs. of  12 variables:
 $ PassengerId: int  1 2 3 4 5 6
 $ Survived   : int  0 1 1 1 0 0
 $ Pclass     : int  3 1 3 1 3 3
 $ Name       : Factor w/ 891 levels "Abbing, Mr. Anthony",..: 109 191 358 277 16 559
 $ Sex        : Factor w/ 2 levels "female","male": 2 1 1 1 2 2
 $ Age        : num  22 38 26 35 35 NA
 $ SibSp      : int  1 1 0 1 0 0
 $ Parch      : int  0 0 0 0 0 0
 $ Ticket     : Factor w/ 681 levels "110152","110413",..: 524 597 670 50 473 276
 $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
 $ Cabin      : Factor w/ 148 levels "","A10","A14",..: 1 83 1 57 1 1
 $ Embarked   : Factor w/ 4 levels "","C","Q","S": 4 2 4 4 4 3
> impute_age <- function(age, class) {
+   out <- age
+   for (i in 1:length(age)) {
+     if (is.na(age[i])) {
+       if (class[i]==1) {
+         out [i] <- 37
+       }else if (class[i] ==2){
+         out[i] <- 29
+       }else {
+         out[i] <- 24
+       } 
+       }else{
+         out[i] <- age[i]
+       }  
+       }
+       return(out)
+     }

> fixed.age <- impute_age(df.train$Age, df.train$Pclass)
> fixed.age
  [1] 22.00 38.00 26.00 35.00 35.00 24.00 54.00  2.00 27.00 14.00  4.00 58.00 20.00 39.00
 [15] 14.00 55.00  2.00 29.00 31.00 24.00 35.00 34.00 15.00 28.00  8.00 38.00 24.00 19.00
 [29] 24.00 24.00 40.00 37.00 24.00 66.00 28.00 42.00 24.00 21.00 18.00 14.00 40.00 27.00
 [43] 24.00  3.00 19.00 24.00 24.00 24.00 24.00 18.00  7.00 21.00 49.00 29.00 65.00 37.00
 [57] 21.00 28.50  5.00 11.00 22.00 38.00 45.00  4.00 37.00 24.00 29.00 19.00 17.00 26.00
 [71] 32.00 16.00 21.00 26.00 32.00 25.00 24.00 24.00  0.83 30.00 22.00 29.00 24.00 28.00
 [85] 17.00 33.00 16.00 24.00 23.00 24.00 29.00 20.00 46.00 26.00 59.00 24.00 71.00 23.00
 [99] 34.00 34.00 28.00 24.00 21.00 33.00 37.00 28.00 21.00 24.00 38.00 24.00 47.00 14.50
[113] 22.00 20.00 17.00 21.00 70.50 29.00 24.00  2.00 21.00 24.00 32.50 32.50 54.00 12.00
[127] 24.00 24.00 24.00 45.00 33.00 20.00 47.00 29.00 25.00 23.00 19.00 37.00 16.00 24.00
[141] 24.00 22.00 24.00 19.00 18.00 19.00 27.00  9.00 36.50 42.00 51.00 22.00 55.50 40.50
[155] 24.00 51.00 16.00 30.00 24.00 24.00 44.00 40.00 26.00 17.00  1.00  9.00 37.00 45.00
[169] 37.00 28.00 61.00  4.00  1.00 21.00 56.00 18.00 24.00 50.00 30.00 36.00 24.00 29.00
[183]  9.00  1.00  4.00 37.00 24.00 45.00 40.00 36.00 32.00 19.00 19.00  3.00 44.00 58.00
[197] 24.00 42.00 24.00 24.00 28.00 24.00 34.00 45.50 18.00  2.00 32.00 26.00 16.00 40.00
[211] 24.00 35.00 22.00 30.00 24.00 31.00 27.00 42.00 32.00 30.00 16.00 27.00 51.00 24.00
[225] 38.00 22.00 19.00 20.50 18.00 24.00 35.00 29.00 59.00  5.00 24.00 24.00 44.00  8.00
[239] 19.00 33.00 24.00 24.00 29.00 22.00 30.00 44.00 25.00 24.00 37.00 54.00 24.00 29.00
[253] 62.00 30.00 41.00 29.00 37.00 30.00 35.00 50.00 24.00  3.00 52.00 40.00 24.00 36.00
[267] 16.00 25.00 58.00 35.00 37.00 25.00 41.00 37.00 24.00 63.00 45.00 29.00  7.00 35.00
[281] 65.00 28.00 16.00 19.00 37.00 33.00 30.00 22.00 42.00 22.00 26.00 19.00 36.00 24.00
[295] 24.00 37.00 23.50  2.00 37.00 50.00 24.00 24.00 19.00 29.00 24.00  0.92 37.00 17.00
[309] 30.00 30.00 24.00 18.00 26.00 28.00 43.00 26.00 24.00 54.00 31.00 40.00 22.00 27.00
[323] 30.00 22.00 24.00 36.00 61.00 36.00 31.00 16.00 24.00 45.50 38.00 16.00 37.00 24.00
[337] 29.00 41.00 45.00 45.00  2.00 24.00 28.00 25.00 36.00 24.00 40.00 24.00  3.00 42.00
[351] 23.00 37.00 15.00 25.00 24.00 28.00 22.00 38.00 24.00 24.00 40.00 29.00 45.00 35.00
[365] 24.00 30.00 60.00 24.00 24.00 24.00 25.00 18.00 19.00 22.00  3.00 37.00 22.00 27.00
[379] 20.00 19.00 42.00  1.00 32.00 35.00 24.00 18.00  1.00 36.00 24.00 17.00 36.00 21.00
[393] 28.00 23.00 24.00 22.00 31.00 46.00 23.00 28.00 39.00 26.00 21.00 28.00 20.00 34.00
[407] 51.00  3.00 21.00 24.00 24.00 24.00 33.00 29.00 44.00 24.00 34.00 18.00 30.00 10.00
[421] 24.00 21.00 29.00 28.00 18.00 24.00 28.00 19.00 24.00 32.00 28.00 24.00 42.00 17.00
[435] 50.00 14.00 21.00 24.00 64.00 31.00 45.00 20.00 25.00 28.00 24.00  4.00 13.00 34.00
[449]  5.00 52.00 36.00 24.00 30.00 49.00 24.00 29.00 65.00 37.00 50.00 24.00 48.00 34.00
[463] 47.00 48.00 24.00 38.00 29.00 56.00 24.00  0.75 24.00 38.00 33.00 23.00 22.00 37.00
[477] 34.00 29.00 22.00  2.00  9.00 29.00 50.00 63.00 25.00 24.00 35.00 58.00 30.00  9.00
[491] 24.00 21.00 55.00 71.00 21.00 24.00 54.00 24.00 25.00 24.00 17.00 21.00 24.00 37.00
[505] 16.00 18.00 33.00 37.00 28.00 26.00 29.00 24.00 36.00 54.00 24.00 47.00 34.00 24.00
[519] 36.00 32.00 30.00 22.00 24.00 44.00 24.00 40.50 50.00 37.00 39.00 23.00  2.00 24.00
[533] 17.00 24.00 30.00  7.00 45.00 30.00 24.00 22.00 36.00  9.00 11.00 32.00 50.00 64.00
[547] 19.00 29.00 33.00  8.00 17.00 27.00 24.00 22.00 22.00 62.00 48.00 37.00 39.00 36.00
[561] 24.00 40.00 28.00 24.00 24.00 24.00 19.00 29.00 24.00 32.00 62.00 53.00 36.00 24.00
[575] 16.00 19.00 34.00 39.00 24.00 32.00 25.00 39.00 54.00 36.00 24.00 18.00 47.00 60.00
[589] 22.00 24.00 35.00 52.00 47.00 24.00 37.00 36.00 29.00 49.00 24.00 49.00 24.00 24.00
[603] 37.00 44.00 35.00 36.00 30.00 27.00 22.00 40.00 39.00 24.00 24.00 24.00 35.00 24.00
[617] 34.00 26.00  4.00 26.00 27.00 42.00 20.00 21.00 21.00 61.00 57.00 21.00 26.00 24.00
[631] 80.00 51.00 32.00 37.00  9.00 28.00 32.00 31.00 41.00 24.00 20.00 24.00  2.00 24.00
[645]  0.75 48.00 19.00 56.00 24.00 23.00 24.00 18.00 21.00 24.00 18.00 24.00 24.00 32.00
[659] 23.00 58.00 50.00 40.00 47.00 36.00 20.00 32.00 25.00 24.00 43.00 37.00 40.00 31.00
[673] 70.00 31.00 29.00 18.00 24.50 18.00 43.00 36.00 24.00 27.00 20.00 14.00 60.00 25.00
[687] 14.00 19.00 18.00 15.00 31.00  4.00 24.00 25.00 60.00 52.00 44.00 24.00 49.00 42.00
[701] 18.00 35.00 18.00 25.00 26.00 39.00 45.00 42.00 22.00 24.00 24.00 37.00 48.00 29.00
[715] 52.00 19.00 38.00 27.00 24.00 33.00  6.00 17.00 34.00 50.00 27.00 20.00 30.00 24.00
[729] 25.00 25.00 29.00 11.00 29.00 23.00 23.00 28.50 48.00 35.00 24.00 24.00 37.00 36.00
[743] 21.00 24.00 31.00 70.00 16.00 30.00 19.00 31.00  4.00  6.00 33.00 23.00 48.00  0.67
[757] 28.00 18.00 34.00 33.00 24.00 41.00 20.00 36.00 16.00 51.00 37.00 30.50 24.00 32.00
[771] 24.00 48.00 57.00 24.00 54.00 18.00 24.00  5.00 24.00 43.00 13.00 17.00 29.00 24.00
[785] 25.00 25.00 18.00  8.00  1.00 46.00 24.00 16.00 24.00 37.00 25.00 39.00 49.00 31.00
[799] 30.00 30.00 34.00 31.00 11.00  0.42 27.00 31.00 39.00 18.00 39.00 33.00 26.00 39.00
[813] 35.00  6.00 30.50 37.00 23.00 31.00 43.00 10.00 52.00 27.00 38.00 27.00  2.00 24.00
[827] 24.00  1.00 24.00 62.00 15.00  0.83 24.00 23.00 18.00 39.00 21.00 24.00 32.00 37.00
[841] 20.00 16.00 30.00 34.50 17.00 42.00 24.00 35.00 28.00 37.00  4.00 74.00  9.00 16.00
[855] 44.00 18.00 45.00 51.00 24.00 24.00 41.00 21.00 48.00 24.00 24.00 42.00 27.00 31.00
[869] 24.00  4.00 26.00 47.00 33.00 47.00 28.00 15.00 20.00 19.00 24.00 56.00 25.00 33.00
[883] 22.00 28.00 25.00 39.00 27.00 19.00 24.00 26.00 32.00
> df.train$Age <- fixed.age
# imputation check : must be missing value now
 missmap(df.train, main = 'Imputation Check', col = c('yellow', 'black'), legend = F)

> df.train <- select(df.train, -PassengerId, -Ticket, -Cabin, - Name)
> df.train %>% head
  Survived Pclass    Sex Age SibSp Parch    Fare Embarked
1        0      3   male  22     1     0  7.2500        S
2        1      1 female  38     1     0 71.2833        C
3        1      3 female  26     0     0  7.9250        S
4        1      1 female  35     1     0 53.1000        S
5        0      3   male  35     0     0  8.0500        S
6        0      3   male  24     0     0  8.4583        Q
> str(df.train)
'data.frame':	891 obs. of  8 variables:
 $ Survived: int  0 1 1 1 0 0 0 0 1 1 ...
 $ Pclass  : int  3 1 3 1 3 3 1 3 3 2 ...
 $ Sex     : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...
 $ Age     : num  22 38 26 35 35 24 54 2 27 14 ...
 $ SibSp   : int  1 1 0 1 0 0 0 3 0 1 ...
 $ Parch   : int  0 0 0 0 0 0 0 1 2 0 ...
 $ Fare    : num  7.25 71.28 7.92 53.1 8.05 ...
 $ Embarked: Factor w/ 4 levels "","C","Q","S": 4 2 4 4 4 3 4 4 4 2 ...
> df.train$Survived <- factor(df.train$Survived)
> df.train$Pclass <- factor(df.train$Pclass)
> df.train$Parch <- factor(df.train$Parch)
> df.train$SibSp <- factor(df.train$SibSp)
> str(df.train)
'data.frame':	891 obs. of  8 variables:
 $ Survived: Factor w/ 2 levels "0","1": 1 2 2 2 1 1 1 1 2 2 ...
 $ Pclass  : Factor w/ 3 levels "1","2","3": 3 1 3 1 3 3 1 3 3 2 ...
 $ Sex     : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...
 $ Age     : num  22 38 26 35 35 24 54 2 27 14 ...
 $ SibSp   : Factor w/ 7 levels "0","1","2","3",..: 2 2 1 2 1 1 1 4 1 2 ...
 $ Parch   : Factor w/ 7 levels "0","1","2","3",..: 1 1 1 1 1 1 1 2 3 1 ...
 $ Fare    : num  7.25 71.28 7.92 53.1 8.05 ...
 $ Embarked: Factor w/ 4 levels "","C","Q","S": 4 2 4 4 4 3 4 4 4 2 ...
> log.model <- glm(Survived ~., family= binomial(link='logit'), data=df.train)
> summary(log.model)

Call:
glm(formula = Survived ~ ., family = binomial(link = "logit"), 
    data = df.train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.8158  -0.6134  -0.4138   0.5808   2.4896  

Coefficients:
              Estimate Std. Error z value Pr(>|z|)    
(Intercept)  1.845e+01  1.660e+03   0.011 0.991134    
Pclass2     -1.079e+00  3.092e-01  -3.490 0.000484 ***
Pclass3     -2.191e+00  3.161e-01  -6.930 4.20e-12 ***
Sexmale     -2.677e+00  2.040e-01 -13.123  < 2e-16 ***
Age         -3.971e-02  8.758e-03  -4.534 5.79e-06 ***
SibSp1       8.135e-02  2.245e-01   0.362 0.717133    
SibSp2      -2.897e-01  5.368e-01  -0.540 0.589361    
SibSp3      -2.241e+00  7.202e-01  -3.111 0.001862 ** 
SibSp4      -1.675e+00  7.620e-01  -2.198 0.027954 *  
SibSp5      -1.595e+01  9.588e+02  -0.017 0.986731    
SibSp8      -1.607e+01  7.578e+02  -0.021 0.983077    
Parch1       3.741e-01  2.895e-01   1.292 0.196213    
Parch2       3.862e-02  3.824e-01   0.101 0.919560    
Parch3       3.655e-01  1.056e+00   0.346 0.729318    
Parch4      -1.586e+01  1.055e+03  -0.015 0.988007    
Parch5      -1.152e+00  1.172e+00  -0.983 0.325771    
Parch6      -1.643e+01  2.400e+03  -0.007 0.994536    
Fare         2.109e-03  2.490e-03   0.847 0.397036    
EmbarkedC   -1.458e+01  1.660e+03  -0.009 0.992995    
EmbarkedQ   -1.456e+01  1.660e+03  -0.009 0.993001    
EmbarkedS   -1.486e+01  1.660e+03  -0.009 0.992857    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1186.66  on 890  degrees of freedom
Residual deviance:  763.41  on 870  degrees of freedom
AIC: 805.41

Number of Fisher Scoring iterations: 15

library(caTools)
set.seed(101)
split <- sample.split(df.train$Survived, SplitRatio = .7)
final.train <- subset(df.train, split ==TRUE)
final.test <- subset(df.train, split ==FALSE)
final.log <- glm(Survived ~., family = binomial(link='logit'), final.train)
summary(final.log)

fitted.probabilities <- predict(final.log, final.test, type ='response')
fitted.result <- ifelse(fitted.probabilities>0.5,1 , 0)
  fitted.result
missClassError <- mean(fitter.result != final.test$Survived)  
missClassError
accurasy <- (1 - missClassError)
accurasy

# confusion metrix
table(final.test$Survived, fitted.probabilities> 0.5)
-------------------------------------------------------


# we were able to achieve around 80% accuracy, where as random guessing would have just been 50% accuracy. 


